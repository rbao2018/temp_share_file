**hf_gunicorn_config.py**
```python
# Copyright 2025 Ant Group. and/or its affiliates
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


# bind port and host
bind = "0.0.0.0:11111"

workers = 64

worker_class = "uvicorn.workers.UvicornWorker"

timeout = 10

# other configs
keepalive = 60
worker_connections = 1024
max_requests = 1024
max_requests_jitter = 50

# log config
loglevel = "info"

```

**hf_math_verify.py**
```python
# Copyright 2025 Ant Group. and/or its affiliates
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

from fastapi import FastAPI, Request
from fastapi.responses import JSONResponse
try:
    from math_verify.errors import TimeoutException
    from math_verify.metric import math_metric
    from math_verify.parser import ExprExtractionConfig, LatexExtractionConfig
except ImportError:
    print("To use Math-Verify, please install it first by running `pip install math-verify`.")


def math_eval(params):
    model_output, ground_truth = params
    verify_func = math_metric(
        gold_extraction_target=(LatexExtractionConfig(),),
        pred_extraction_target=(ExprExtractionConfig(), LatexExtractionConfig()),
    )
    ret_score = 0.0
    
    # Wrap the ground truth in \boxed{} format for verification
    ground_truth_boxed = "\\boxed{" + ground_truth + "}"
    model_output = "\\boxed{" + model_output + "}"
    
    try:
        ret_score, _ = verify_func([ground_truth_boxed], [model_output])
    except Exception:
        pass
    except TimeoutException:
        ret_score = 0.0

    return ret_score

    
class EvaluationProxy:
    def __init__(self):
        self.timeout = 30

    def get_result(self, solution: str, ground_truth: str, **kwargs):
        results = math_eval((solution, ground_truth))
        return results


# create FastAPI app
def create_app():
    eval_proxy = EvaluationProxy()
    app = FastAPI()

    @app.post("/get_reward")
    async def get_eval_result(request: Request):
        data = await request.json()
        predictions = data.get("predictions")
        answers = data.get("answers")
        results = eval_proxy.get_result(predictions, answers)
        result = {"reward": results}
        return JSONResponse(result)
        
    return app


app = create_app()
```


**serve_hf_math_verify.sh**
```bash
# Copyright 2025 Ant Group. and/or its affiliates
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

set -x


pip install gunicorn -i https://pypi.antfin-inc.com/simple

FILE_DIR=$(dirname "$(realpath "${BASH_SOURCE[0]}")")
echo $FILE_DIR
cd $FILE_DIR

# start app

start_server() {
    gunicorn hf_math_verify:app --config hf_gunicorn_config.py --preload > /root/hf_math_verify.log 2>&1 &
    echo $! > /tmp/hf_math_verify_gunicorn.pid
}

health_check() {
    timeout 10 curl -X POST http://localhost:11111/get_reward -H 'Content-Type: application/json' -d '{"predictions": "\\frac{1}{2}", "answers": "0.5"}'
    return $?
}

# 初始启动服务
start_server

# 创建监控循环函数
monitor_loop() {
    while true; do
        sleep 60
        if ! health_check; then
            echo "Health check failed, restarting server..." >> /root/hf_math_verify_monitor.log
            if [ -f /tmp/hf_math_verify_gunicorn.pid ]; then
                kill $(cat /tmp/hf_math_verify_gunicorn.pid) || true
                rm /tmp/hf_math_verify_gunicorn.pid
            fi
            start_server
        fi
    done
}

# 在后台启动监控循环并将其PID保存到文件
monitor_loop > /root/hf_math_verify_monitor.log 2>&1 &
echo $! > /tmp/hf_math_verify_monitor.pid

echo "Monitor started in background. Monitor PID: $(cat /tmp/hf_math_verify_monitor.pid)"
```
